<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROVA RAC 08</title>

<!-- INSERT_YOUR_CODE -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body class="flex flex-col items-center justify-center min-h-screen bg-white">
    <div class="flex flex-col items-center w-full max-w-md space-y-4 p-4">
        <img src="https://cestsegtrabalho.com.br/wp-content/uploads/2022/09/logo-e1663851774609.png" width="40%">
        <h1 class="text-3xl font-bold text-center">RAC 08</h1>
        <h2 class="text-xl font-bold text-center">Preencha os dados abaixo e faça a prova <br> Nota mínima 80% <br> Após aprovação já está registrado</h2>

        <form class="flex flex-col gap-3 w-full"
         action="#" name="form-contact" id="form-contact">
            <input type="text" placeholder="Nome completo" class="border rounded p-2 w-full" id="name" required> 
            <input type="text" placeholder="CPF" class="border rounded p-2 w-full" id="cpf" required>   
            <input type="text" placeholder="Whatsapp" class="border rounded p-2 w-full" id="whatsapp" required>
            <input type="email" placeholder="Email" class="border rounded p-2 w-full" id="email" required>
            <input type="text" placeholder="Nome da empresa (opcional)" class="border rounded p-2 w-full" id="nome_empresa">
            <input type="text" placeholder="Digite a Senha" class="border rounded p-2 w-full" id="senha" required pattern="\d*" inputmode="numeric" autocomplete="off" oninput="this.value=this.value.replace(/[^\d]/g,'')">
                        <h2 class="text-1xl font-bold text-center">Data de hoje</h2>
            <div class="flex flex-row gap-2 items-center justify-center w-full">
                <input type="number" id="dia_Genilson" placeholder="DD" min="1" max="31" required pattern="[0-9]{2}" class="border rounded p-2 text-center" style="width: 80px;">
                <span class="text-xl font-bold">/</span>
                <input type="number" id="mes_Genilson" placeholder="MM" min="1" max="12" required pattern="[0-9]{2}" class="border rounded p-2 text-center" style="width: 80px;">
                <span class="text-xl font-bold">/</span>
                <input type="number" id="ano_Genilson" placeholder="AAAA" min="1900" max="2100" required pattern="[0-9]{4}" class="border rounded p-2 text-center" style="width: 100px;">
            </div>
            <input type="hidden" id="data_Genilson" name="data_Genilson">
            <input type="submit" value="Fazer Prova" class="bg-black text-white font-bold rounded p-2 cursor-pointer w-full" id="submit">
        </form>

    </div>
</body>
<script>
    // Função para formatar número com zero à esquerda
    function pad2(n) { 
        return n.toString().padStart(2, '0'); 
    }

    // Função para atualizar o campo hidden com a data formatada
    function updateDataGenilson() {
        const d = document.getElementById('dia_Genilson').value;
        const m = document.getElementById('mes_Genilson').value;
        const a = document.getElementById('ano_Genilson').value;
        if (d.length > 0 && m.length > 0 && a.length === 4) {
            document.getElementById('data_Genilson').value = pad2(d) + '/' + pad2(m) + '/' + a;
        } else {
            document.getElementById('data_Genilson').value = '';
        }
    }

    // Preenche automaticamente com a data de hoje ao carregar a página
    window.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        document.getElementById('dia_Genilson').value = pad2(today.getDate());
        document.getElementById('mes_Genilson').value = pad2(today.getMonth() + 1);
        document.getElementById('ano_Genilson').value = today.getFullYear();
        updateDataGenilson();
        
        // Adiciona event listeners para atualizar quando os campos mudarem
        document.getElementById('dia_Genilson').addEventListener('input', updateDataGenilson);
        document.getElementById('mes_Genilson').addEventListener('input', updateDataGenilson);
        document.getElementById('ano_Genilson').addEventListener('input', updateDataGenilson);
    });
   
    function validarSenha() {
        const senha = document.getElementById("senha").value.trim();
        
        // Não aceita letras, caracteres especiais ou espaço. Apenas números.
        if (!/^\d+$/.test(senha)) {
            alert("A senha deve conter apenas números, sem espaços ou caracteres especiais.");
            return false;
        }

        if (senha !== '333') {
            alert("Senha incorreta! Tente novamente.");
            return false;
        }
        return true;
    }

    // Adiciona event listener no formulário
    document.getElementById('form-contact').addEventListener('submit', function(e) {
        e.preventDefault(); // Previne o envio padrão do formulário
        
        // Valida a senha
        if (!validarSenha()) {
            return; // Se a senha estiver errada, interrompe aqui
        }

        // Se passou na validação, processa o envio
        const name = document.getElementById('name');
        const whatsapp = document.getElementById('whatsapp');
        const email = document.getElementById('email');
        const nome_empresa = document.getElementById('nome_empresa');
        const cpf = document.getElementById('cpf');
        const dataGenilson = document.getElementById('data_Genilson');

        // A data já está formatada no campo hidden como dd/mm/aaaa
        const dataFormatada = dataGenilson.value || '';

        // Função para salvar no localStorage
        function setLocalStorage() {
            localStorage.setItem("name", name.value);
            localStorage.setItem("cpf", cpf.value);
        }

        // Função para enviar dados para API
        const enviarDados = async () => {
            try {
                const curso = document.title;
                const response = await axios.post('https://app.cestsegtrabalho.com.br/dobrascutaneas/criar', { 
                    subescapular: name.value, 
                    peitoral: email.value, 
                    triciptal: whatsapp.value, 
                    abdominal: curso 
                });
                console.log('Prova iniciada com sucesso');
                return true;
            } catch (error) {
                console.error('Erro ao iniciar prova: ', error);
                return false;
            }
        };

        // Processa o envio sem email
        setLocalStorage();
        enviarDados().then(() => {
            alert("Prova iniciada com sucesso!");
            window.location.href = "/src/provas/provas-racs/prova-rac8.html";
        }).catch(() => {
            alert("Erro ao iniciar prova. Tente novamente.");
        });
    });
</script>
</html>